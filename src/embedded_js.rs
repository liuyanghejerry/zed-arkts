// æ­¤æ–‡ä»¶ç”± build.rs è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹
/// åµŒå…¥çš„è¯­è¨€æœåŠ¡å™¨åŒ…è£…å™¨ JavaScript ä»£ç 
pub const INDEX_JS_CONTENT: &str = "#!/usr/bin/env node\\n\\nimport { spawn } from 'node:child_process';\\nimport fs from 'node:fs';\\nimport path from 'node:path';\\nimport { fileURLToPath } from 'node:url';\\n\\nconst __filename = fileURLToPath(import.meta.url);\\nconst __dirname = path.dirname(__filename);\\n\\n// ETSè¯­è¨€æœåŠ¡å™¨è·¯å¾„ï¼Œç”±Rustæ‰©å±•è¿›ç¨‹é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’\\nconst etsLangServerPath = process.env.ETS_LANG_SERVER;\\n\\n// åˆ›å»ºæ—¥å¿—æ–‡ä»¶å†™å…¥æµ\\nconst logFilePath = path.join(__dirname, 'arkts-lsw.log');\\nconst logStream = fs.createWriteStream(logFilePath, { flags: 'w+' });\\n\\n// è·å–å½“å‰æ—¶é—´æˆ³çš„å‡½æ•°\\nconst getTimestamp = () => {\\n  const now = new Date();\\n  return now.toISOString().slice(0, 19).replace('T', ' ');\\n};\\n\\n// æ—¥å¿—å·¥å…·\\nconst logger = {\\n  info: (msg) => {\\n    const timestamp = getTimestamp();\\n    const logMsg = `[${timestamp}] â„¹ ${msg}\\\\n`;\\n    logStream.write(logMsg);\\n  },\\n  success: (msg) => {\\n    const timestamp = getTimestamp();\\n    const logMsg = `[${timestamp}] âœ“ ${msg}\\\\n`;\\n    logStream.write(logMsg);\\n  },\\n  error: (msg) => {\\n    const timestamp = getTimestamp();\\n    const logMsg = `[${timestamp}] âœ— ${msg}\\\\n`;\\n    logStream.write(logMsg);\\n    process.stderr.write(logMsg);\\n  },\\n  warn: (msg) => {\\n    const timestamp = getTimestamp();\\n    const logMsg = `[${timestamp}] âš  ${msg}\\\\n`;\\n    logStream.write(logMsg);\\n  },\\n  section: (msg) => {\\n    const timestamp = getTimestamp();\\n    const logMsg = `\\\\n[${timestamp}] ${msg}\\\\n\\\\n`;\\n    logStream.write(logMsg);\\n  },\\n  data: (label, data) => {\\n    const timestamp = getTimestamp();\\n    const logMsg = `[${timestamp}]   ${label}: ${JSON.stringify(data, null, 2)}\\\\n`;\\n    logStream.write(logMsg);\\n  },\\n  // æ·»åŠ å…³é—­æ—¥å¿—æµçš„æ–¹æ³•\\n  close: () => {\\n    logStream.end();\\n  }\\n};\\n\\n// ä¸»å‡½æ•° - ç®€åŒ–ç‰ˆæœ¬ï¼Œåªåšè½¬å‘\\nasync function main() {\\n  logger.section('ğŸš€ ArkTS Language Server Wrapper');\\n\\n  // æ£€æŸ¥è¯­è¨€æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨\\n  const serverExists = fs.existsSync(etsLangServerPath);\\n\\n  if (!serverExists) {\\n    logger.error(`è¯­è¨€æœåŠ¡å™¨ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ„å»ºè¯­è¨€æœåŠ¡å™¨ ${etsLangServerPath}`);\\n    return;\\n  }\\n\\n  logger.success(`è¯­è¨€æœåŠ¡å™¨è·¯å¾„: ${etsLangServerPath}`);\\n\\n  // å¯åŠ¨è¯­è¨€æœåŠ¡å™¨\\n  logger.section('ğŸ”Œ å¯åŠ¨è¯­è¨€æœåŠ¡å™¨');\\n\\n  const serverProcess = spawn('node', [etsLangServerPath, '--node-ipc', '--server-mode'], {\\n    stdio: ['pipe', 'pipe', 'pipe', 'ipc'],\\n    env: { ...process.env },\\n  });\\n\\n  // ç›‘å¬æœåŠ¡å™¨è¿›ç¨‹çš„é”™è¯¯å’Œé€€å‡ºäº‹ä»¶\\n  serverProcess.on('error', (error) => {\\n    logger.error(`è¯­è¨€æœåŠ¡å™¨è¿›ç¨‹é”™è¯¯: ${error.message}`);\\n  });\\n\\n  serverProcess.on('exit', (code, signal) => {\\n    logger.info(`è¯­è¨€æœåŠ¡å™¨è¿›ç¨‹é€€å‡ºï¼Œé€€å‡ºç : ${code}, ä¿¡å·: ${signal}`);\\n  });\\n\\n  // è®¾ç½® serverProcess IPC æ¶ˆæ¯åˆ° process.stdout çš„è½¬å‘\\n  serverProcess.on('message', (message) => {\\n    // å°† IPC æ¶ˆæ¯è½¬æ¢ä¸ºæ ‡å‡†çš„ LSP æ ¼å¼å¹¶å‘é€åˆ° stdout\\n    const messageStr = JSON.stringify(message);\\n    const headers = `Content-Length: ${Buffer.byteLength(messageStr)}\\\\r\\\\n\\\\r\\\\n`;\\n    process.stdout.write(headers + messageStr);\\n  });\\n\\n  // è®¾ç½® process.stdin åˆ° serverProcess IPC çš„è½¬å‘\\n  let stdinBuffer = '';\\n  process.stdin.on('data', (data) => {\\n    stdinBuffer += data.toString();\\n\\n    while (true) {\\n      // æŸ¥æ‰¾ Content-Length å¤´\\n      const lengthMatch = stdinBuffer.match(/Content-Length: (\\\\d+)\\\\r\\\\n/);\\n      if (!lengthMatch) break;\\n\\n      const contentLength = Number.parseInt(lengthMatch[1]);\\n      const headerEnd = stdinBuffer.indexOf('\\\\r\\\\n\\\\r\\\\n');\\n\\n      if (headerEnd === -1) break;\\n\\n      const messageStart = headerEnd + 4;\\n      const messageEnd = messageStart + contentLength;\\n\\n      if (stdinBuffer.length < messageEnd) break;\\n\\n      // æå–æ¶ˆæ¯\\n      const messageJson = stdinBuffer.substring(messageStart, messageEnd);\\n      stdinBuffer = stdinBuffer.substring(messageEnd);\\n\\n      try {\\n        const message = JSON.parse(messageJson);\\n        // é€šè¿‡ IPC å‘é€æ¶ˆæ¯åˆ°è¯­è¨€æœåŠ¡å™¨\\n        serverProcess.send(message);\\n      } catch (error) {\\n        logger.error(`è§£ææ¥è‡ª stdin çš„æ¶ˆæ¯å¤±è´¥: ${error.message}, ${messageJson}`);\\n      }\\n    }\\n  });\\n\\n  // é”™è¯¯å¤„ç†\\n  process.on('SIGTERM', () => {\\n    logger.info('æ”¶åˆ° SIGTERM ä¿¡å·ï¼Œæ­£åœ¨å…³é—­è¯­è¨€æœåŠ¡å™¨...');\\n    serverProcess.kill();\\n    logger.close();\\n    process.exit(0);\\n  });\\n\\n  process.on('SIGINT', () => {\\n    logger.info('æ”¶åˆ° SIGINT ä¿¡å·ï¼Œæ­£åœ¨å…³é—­è¯­è¨€æœåŠ¡å™¨...');\\n    serverProcess.kill();\\n    logger.close();\\n    process.exit(0);\\n  });\\n\\n  logger.success('è¯­è¨€æœåŠ¡å™¨åŒ…è£…å™¨å·²å¯åŠ¨ï¼Œå¼€å§‹è½¬å‘æ¶ˆæ¯');\\n}\\n\\n// é”™è¯¯å¤„ç†\\nprocess.on('uncaughtException', (error) => {\\n  logger.error(`æœªæ•è·çš„å¼‚å¸¸: ${error.message}`);\\n  console.error(error);\\n  logger.close(); // å…³é—­æ—¥å¿—æµ\\n  process.exit(1);\\n});\\n\\nprocess.on('unhandledRejection', (reason, _promise) => {\\n  logger.error(`æœªå¤„ç†çš„ Promise æ‹’ç»: ${reason}`);\\n  console.error(reason);\\n  logger.close(); // å…³é—­æ—¥å¿—æµ\\n  process.exit(1);\\n});\\n\\n// è¿è¡Œä¸»å‡½æ•°\\nmain();\\n";
